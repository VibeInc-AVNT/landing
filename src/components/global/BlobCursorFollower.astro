<div id="cursor-follower" data-xdata="{ isTouchDevice: 'ontouchstart' in window }" data-xshow="!isTouchDevice">
	<div id="blob" class="blob"></div>
</div>

<script>
	// Vanilla replacement for the previous GSAP-powered cursor follower
	function init() {
		const isTouchDevice = window.matchMedia("(hover: none)").matches;

		if (isTouchDevice) return;

		const mouse = { x: 0, y: 0 };
		const pos = { x: 0, y: 0 };
		const ratio = 0.65;
		const blob = document.getElementById("blob");
		const magicCursor = document.getElementById("cursor-follower");

		if (!blob || !magicCursor) return;

		// center the blob by default and keep scale from CSS
		blob.style.transform = 'translate(-50%, -50%) scale(0.5)';

		let rafId = null;

		function updatePosition() {
			pos.x += (mouse.x - pos.x) * ratio;
			pos.y += (mouse.y - pos.y) * ratio;

			blob.style.left = pos.x + 'px';
			blob.style.top = pos.y + 'px';

			rafId = requestAnimationFrame(updatePosition);
		}

		function mouseMove(e) {
			const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
			mouse.x = e.pageX;
			mouse.y = e.pageY - scrollTop;
		}

		document.addEventListener('mousemove', mouseMove);
		updatePosition();

		const parallaxWraps = document.querySelectorAll("[data-cursor-hover]");

		parallaxWraps.forEach(function (wrap) {
			function magneticElement(e, target, movement) {
				const boundingRect = target.getBoundingClientRect();
				const relX = e.pageX - boundingRect.left;
				const relY = e.pageY - boundingRect.top;
				const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

				const x = ((relX - boundingRect.width / 2) / boundingRect.width) * movement;
				const y = ((relY - boundingRect.height / 2 - scrollTop) / boundingRect.height) * movement;

				target.style.transition = 'transform 0.3s ease-out';
				target.style.transform = `translate(${x}px, ${y}px)`;
			}

			wrap.addEventListener("mouseenter", function () {
				blob.style.transition = 'opacity 0.5s';
				blob.style.opacity = '0.5';
			});

			wrap.addEventListener("mouseleave", function () {
				blob.style.transition = 'opacity 0.5s';
				blob.style.opacity = '0.2';

				if (wrap && wrap.hasAttribute("data-cursor-parallax")) {
					wrap.style.transition = 'transform 0.3s';
					wrap.style.transform = '';
				}
			});

			wrap.addEventListener("mousemove", function (e) {
				if (wrap && wrap.hasAttribute("data-cursor-parallax")) {
					magneticElement(e, wrap, 10);
				}
			});
		});

		magicCursor?.classList.add("active");
	}

	document.removeEventListener("DOMContentLoaded", init); // astro:page-load
	document.addEventListener("DOMContentLoaded", init); // astro:page-load
</script>

<style>
	#cursor-follower {
		position: absolute;
		opacity: 0;
		/* z-index: -20; */
		height: 100%;
		width: 100%;
		-webkit-transition: opacity 0.2s ease-in-out 1s;
		transition: opacity 0.2s ease-in-out 1s;
	}

	@keyframes fadeIn {
		0% {
			opacity: 0;
		}
		100% {
			opacity: 1;
		}
	}

	#cursor-follower.active {
		animation: fadeIn 2s forwards;
		-webkit-animation: fadeIn 2s forwards;
		-moz-animation: fadeIn 2s forwards;
		-o-animation: fadeIn 2s forwards;
		-ms-animation: fadeIn 2s forwards;
	}

	#blob {
		position: fixed;
		border-radius: 100px;
		filter: blur(100px);
		opacity: 20%;
		top: 0;
		left: 0;
		height: 500px;
		width: 500px;
		background-color: #edb74d;
		-webkit-transform: scale(0.5);
		transform: scale(0.5);
	}
</style>
