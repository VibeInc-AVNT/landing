---
import { Image } from "astro:assets";
import advertisingSvg from "@assets/images/services/advertising.svg?raw";
import designSvg from "@assets/images/services/creative-designer-doing-multitasking.svg?raw";
import mobileSvg from "@assets/images/services/mobile-app-ui-ux-design.svg?raw";
import seoSvg from "@assets/images/services/seo-link-building.svg?raw";
import websiteSvg from "@assets/images/services/website-ui-ux-development.svg?raw";
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const { class: className } = Astro.props;

const points = [
	{
		title: t("websites.title"),
		content: t("websites.content"),
		image: websiteSvg,
	},
	{
		title: t("apps.title"),
		content: t("apps.content"),
		image: mobileSvg,
	},
	{
		title: t("uiux.title"),
		content: t("uiux.content"),
		image: designSvg,
	},
	{
		title: t("seo.title"),
		content: t("seo.content"),
		image: seoSvg,
	},
	{
		title: t("advertising.title"),
		content: t("advertising.content"),
		image: advertisingSvg,
	},
];
---

<section id="services" class:list={["section home-dark-section services-section relative", className]}>
	<div class="wrapper col-span-12 h-screen w-full">
		<h2 class="sr-only">{t("services")}</h2>
		<div class="indicators absolute left-0 top-0 mt-[10vh] hidden h-[80vh] w-1 flex-col justify-between gap-2">
			{points.map(() => <div class="indicator w-full grow bg-[#333333]" />)}
		</div>
		{
			points.map(({ title, content, image }) => (
				<div class="point flex h-screen w-full flex-col items-center justify-center gap-x-20 gap-y-12 p-16 pr-0 md:flex-row lg:gap-x-40">
					<div class="hidden w-full max-w-80 lg:block">
						<Fragment set:html={image} class="" />
					</div>
					<article class="flex flex-col gap-14">
						<h3 class="faq font-display text-4xl uppercase md:text-5xl lg:text-6xl">{title}</h3>
						<p class="max-w-2xl text-lg" set:html={content} />
					</article>
				</div>
			))
		}
	</div>
</section>

<script>
	// Simpler, GSAP-free fallbacks for the services scroll behaviour:
	// - show indicators
	// - reveal each point's svg and text when it comes into view
	// - update indicators to reflect the currently visible point
	function init() {
		const indicatorsContainer = document.querySelector('.indicators');
		if (indicatorsContainer) indicatorsContainer.style.display = 'flex';

		const points = Array.from(document.querySelectorAll('.point'));
		const indicators = Array.from(document.querySelectorAll('.indicator'));

		const observer = new IntersectionObserver(entries => {
			entries.forEach(entry => {
				const point = entry.target;
				const idx = points.indexOf(point);
				if (entry.isIntersecting) {
					point.querySelector('svg')?.style && (point.querySelector('svg').style.opacity = '1');
					const article = point.querySelector('article');
					if (article) {
						article.style.transition = 'opacity 400ms ease, transform 400ms ease';
						article.style.opacity = '1';
						article.style.transform = 'translateY(0)';
					}

					indicators.forEach((ind, i) => (ind.style.backgroundColor = i === idx ? 'white' : '#333333'));
				} else {
					// Optionally hide when out of view
				}
			});
		}, { threshold: 0.5 });

		points.forEach(p => {
			const svg = p.querySelector('svg');
			if (svg) svg.style.opacity = '0';
			const article = p.querySelector('article');
			if (article) {
				article.style.opacity = '0';
				article.style.transform = 'translateY(100px)';
			}
			observer.observe(p);
		});
	}

	document.removeEventListener('DOMContentLoaded', init); // astro:page-load
	document.addEventListener('DOMContentLoaded', init); // astro:page-load
</script>
