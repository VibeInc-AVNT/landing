---
import { getLangFromUrl, useTranslations } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { class: className } = Astro.props;

const problems = [
	{
		stat: t("problem.1.stat"),
		title: t("problem.1.title"),
		desc: t("problem.1.desc"),
		icon: `<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
		color: "text-vibe-red",
	},
	{
		stat: t("problem.2.stat"),
		title: t("problem.2.title"),
		desc: t("problem.2.desc"),
		icon: `<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
		color: "text-vibe-orange",
	},
	{
		stat: t("problem.3.stat"),
		title: t("problem.3.title"),
		desc: t("problem.3.desc"),
		icon: `<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>`,
		color: "text-vibe-yellow",
	},
];
---

<section id="problem" class:list={["section relative bg-gray-50 py-24 lg:py-32", className]}>
	<div class="relative z-10 col-span-12">
		<!-- Section header -->
		<div class="mx-auto mb-16 max-w-3xl text-center lg:mb-20">
			<h2 class="font-display text-4xl font-bold uppercase text-gray-900 md:text-5xl lg:text-6xl">
				{t("problem.title")}
			</h2>
		</div>

		<!-- Problem cards -->
		<div class="mx-auto grid max-w-5xl gap-6 md:grid-cols-3">
			{problems.map((problem, i) => (
				<div
					class="problem-card neo-card group bg-white p-8"
					style={`animation-delay: ${i * 0.1}s;`}
				>
					<!-- Icon -->
					<div class={`mb-4 inline-flex ${problem.color}`}>
						<Fragment set:html={problem.icon} />
					</div>

					<!-- Stat -->
					<div class={`mb-3 font-display text-4xl font-bold ${problem.color} md:text-5xl`}>
						{problem.stat}
					</div>

					<!-- Title -->
					<h3 class="mb-2 text-lg font-bold text-gray-900 ">
						{problem.title}
					</h3>

					<!-- Description -->
					<p class="text-sm text-gray-600 ">
						{problem.desc}
					</p>
				</div>
			))}
		</div>
	</div>
</section>

<style>
	.problem-card {
		animation: fadeInUp 0.6s ease-out both;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>

<script>
	function init() {
		const cards = document.querySelectorAll('.problem-card');

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						(entry.target as HTMLElement).style.animationPlayState = 'running';
					}
				});
			},
			{ threshold: 0.2 }
		);

		cards.forEach((card) => {
			(card as HTMLElement).style.animationPlayState = 'paused';
			observer.observe(card);
		});
	}

	document.removeEventListener('DOMContentLoaded', init);
	document.addEventListener('DOMContentLoaded', init);
</script>
