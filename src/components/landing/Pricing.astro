---
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const { class: className } = Astro.props;

const plans = [
	{
		name: t("pricing.starter.name"),
		price: t("pricing.starter.price"),
		period: t("pricing.starter.period"),
		requests: t("pricing.starter.requests"),
		features: [
			t("pricing.starter.feature1"),
			t("pricing.starter.feature2"),
			t("pricing.starter.feature3"),
			t("pricing.starter.feature4"),
		],
		cta: t("pricing.starter.cta"),
		highlighted: false,
	},
	{
		name: t("pricing.growth.name"),
		price: t("pricing.growth.price"),
		period: t("pricing.growth.period"),
		requests: t("pricing.growth.requests"),
		features: [
			t("pricing.growth.feature1"),
			t("pricing.growth.feature2"),
			t("pricing.growth.feature3"),
			t("pricing.growth.feature4"),
		],
		cta: t("pricing.growth.cta"),
		highlighted: true,
		badge: t("pricing.growth.popular"),
	},
	{
		name: t("pricing.enterprise.name"),
		price: t("pricing.enterprise.price"),
		period: t("pricing.enterprise.period"),
		requests: t("pricing.enterprise.requests"),
		features: [
			t("pricing.enterprise.feature1"),
			t("pricing.enterprise.feature2"),
			t("pricing.enterprise.feature3"),
			t("pricing.enterprise.feature4"),
		],
		cta: t("pricing.enterprise.cta"),
		highlighted: false,
	},
];
---

<section id="pricing" class:list={["section relative bg-gray-50 py-24 dark:bg-vibe-purple-800/30 lg:py-32", className]}>
	<div class="relative z-10 col-span-12">
		<!-- Section header -->
		<div class="mx-auto mb-12 max-w-3xl text-center lg:mb-16">
			<h2 class="font-display text-4xl font-bold uppercase text-gray-900 dark:text-white md:text-5xl lg:text-6xl">
				{t("pricing.title")}
			</h2>
		</div>

		<!-- Billing toggle -->
		<div class="mb-12 flex items-center justify-center gap-4">
			<span class="text-sm text-gray-600 dark:text-gray-400" id="monthly-label">{t("pricing.monthly")}</span>
			<button
				id="billing-toggle"
				class="relative h-8 w-14 rounded-full bg-gray-200 transition-colors hover:bg-gray-300 dark:bg-vibe-purple-700 dark:hover:bg-vibe-purple-600"
				aria-label="Toggle billing period"
			>
				<span class="billing-dot absolute left-1 top-1 h-6 w-6 rounded-full bg-vibe-purple transition-transform dark:bg-vibe-yellow"></span>
			</button>
			<span class="flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400" id="annual-label">
				{t("pricing.annual")}
				<span class="rounded-full bg-vibe-yellow/20 px-2 py-0.5 text-xs font-medium text-vibe-yellow-700 dark:text-vibe-yellow">
					{t("pricing.annual.save")}
				</span>
			</span>
		</div>

		<!-- Pricing cards -->
		<div class="mx-auto grid max-w-5xl gap-6 lg:grid-cols-3">
			{plans.map((plan, i) => (
				<div
					class={`pricing-card group relative overflow-hidden rounded-2xl border p-8 transition-all ${
						plan.highlighted
							? 'border-vibe-purple bg-white shadow-xl dark:border-vibe-yellow dark:bg-vibe-purple-800'
							: 'border-gray-200 bg-white dark:border-vibe-purple-700 dark:bg-vibe-purple-800/50'
					} hover:shadow-lg`}
					style={`animation-delay: ${i * 0.1}s;`}
				>
					{/* Popular badge */}
					{plan.badge && (
						<div class="absolute -right-10 top-5 rotate-45 bg-vibe-purple px-10 py-1 text-xs font-semibold text-white dark:bg-vibe-yellow dark:text-vibe-purple-900">
							{plan.badge}
						</div>
					)}

					{/* Plan name */}
					<h3 class="mb-4 text-lg font-bold text-gray-900 dark:text-white">
						{plan.name}
					</h3>

					{/* Price */}
					<div class="mb-2 flex items-baseline gap-1">
						<span class={`text-4xl font-bold ${plan.highlighted ? 'text-vibe-purple dark:text-vibe-yellow' : 'text-gray-900 dark:text-white'}`}>
							{plan.price}
						</span>
						{plan.period && (
							<span class="text-gray-500 dark:text-gray-400">{plan.period}</span>
						)}
					</div>

					{/* Requests */}
					<p class="mb-6 text-sm text-gray-600 dark:text-gray-400">
						{plan.requests}
					</p>

					{/* Features */}
					<ul class="mb-8 space-y-3">
						{plan.features.map((feature) => (
							<li class="flex items-center gap-3">
								<svg class="h-5 w-5 flex-shrink-0 text-vibe-purple dark:text-vibe-yellow" fill="none" viewBox="0 0 24 24" stroke="currentColor">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
								</svg>
								<span class="text-sm text-gray-600 dark:text-gray-300">{feature}</span>
							</li>
						))}
					</ul>

					{/* CTA */}
					<a
						href={translatePath("/contact/")}
						class={`block w-full rounded-lg py-3 text-center font-semibold transition-all ${
							plan.highlighted
								? 'bg-vibe-purple text-white hover:bg-vibe-purple-600 dark:bg-vibe-yellow dark:text-vibe-purple-900 dark:hover:bg-vibe-yellow-400'
								: 'border-2 border-gray-200 text-gray-700 hover:border-vibe-purple hover:text-vibe-purple dark:border-vibe-purple-600 dark:text-gray-300 dark:hover:border-vibe-yellow dark:hover:text-vibe-yellow'
						}`}
					>
						{plan.cta}
					</a>
				</div>
			))}
		</div>

		<!-- Bottom note -->
		<div class="mx-auto mt-10 max-w-2xl text-center">
			<p class="text-sm font-semibold text-vibe-yellow-900 bg-vibe-yellow-50 border border-vibe-yellow-200 rounded-lg px-4 py-3 mb-3">
				Service not yet available. Pricing is subject to change.
			</p>
			<p class="text-sm text-gray-500 dark:text-gray-400">
				Contact us for more information about our development progress and launch timeline.
			</p>
		</div>
	</div>
</section>

<style>
	.pricing-card {
		animation: fadeInUp 0.6s ease-out both;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	#billing-toggle.annual .billing-dot {
		transform: translateX(24px);
	}
</style>

<script>
	function init() {
		const toggle = document.getElementById('billing-toggle');
		const monthlyLabel = document.getElementById('monthly-label');
		const annualLabel = document.getElementById('annual-label');
		let isAnnual = false;

		toggle?.addEventListener('click', () => {
			isAnnual = !isAnnual;
			toggle.classList.toggle('annual', isAnnual);

			// Update label colors based on selection
			if (monthlyLabel && annualLabel) {
				if (isAnnual) {
					monthlyLabel.classList.add('text-gray-400');
					monthlyLabel.classList.remove('text-vibe-purple', 'dark:text-vibe-yellow');
					annualLabel.classList.remove('text-gray-400');
					annualLabel.classList.add('text-vibe-purple', 'dark:text-vibe-yellow');
				} else {
					annualLabel.classList.add('text-gray-400');
					annualLabel.classList.remove('text-vibe-purple', 'dark:text-vibe-yellow');
					monthlyLabel.classList.remove('text-gray-400');
					monthlyLabel.classList.add('text-vibe-purple', 'dark:text-vibe-yellow');
				}
			}
		});

		// Animate cards on scroll
		const cards = document.querySelectorAll('.pricing-card');
		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						(entry.target as HTMLElement).style.animationPlayState = 'running';
					}
				});
			},
			{ threshold: 0.2 }
		);

		cards.forEach((card) => {
			(card as HTMLElement).style.animationPlayState = 'paused';
			observer.observe(card);
		});
	}

	document.removeEventListener('DOMContentLoaded', init);
	document.addEventListener('DOMContentLoaded', init);
</script>
