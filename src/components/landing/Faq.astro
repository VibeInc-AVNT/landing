---
import { getLangFromUrl, useTranslations, useTranslatedPath } from "@i18n/utils";

const { class: className } = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const translatePath = useTranslatedPath(lang);

const faqs = [
	{
		question: t("faqs.question1"),
		answer: t("faqs.answer1"),
	},
	{
		question: t("faqs.question2"),
		answer: t("faqs.answer2"),
	},
	{
		question: t("faqs.question3"),
		answer: t("faqs.answer3"),
	},
	{
		question: t("faqs.question4"),
		answer: t("faqs.answer4"),
	},
	{
		question: t("faqs.question5"),
		answer: t("faqs.answer5"),
	},
	{
		question: t("faqs.question6"),
		answer: t("faqs.answer6"),
	},
	{
		question: t("faqs.question7"),
		answer: t("faqs.answer7"),
	},
	{
		question: t("faqs.question8"),
		answer: t("faqs.answer8"),
	},
];
---

<section id="faq" class:list={["section relative bg-white py-24 dark:bg-vibe-purple-900 lg:py-32", className]}>
	<div class="relative z-10 col-span-12">
		<div class="mx-auto flex max-w-5xl flex-col gap-12 lg:flex-row lg:gap-16">
			<!-- Left column - Title -->
			<div class="lg:sticky lg:top-32 lg:h-fit lg:w-1/3">
				<h2 class="font-display text-4xl font-bold uppercase text-gray-900 dark:text-white md:text-5xl">
					FAQ
				</h2>
				<p class="mt-4 text-gray-600 dark:text-gray-400">
					Everything you need to know about Vibe Cache. Can't find the answer you're looking for?
				</p>
				<a
					href={translatePath("/contact/")}
					class="mt-6 inline-flex items-center gap-2 text-vibe-purple transition-colors hover:text-vibe-purple-600 dark:text-vibe-yellow dark:hover:text-vibe-yellow-400"
				>
					{t("faq.otherquestions")}
					<svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
					</svg>
				</a>
			</div>

			<!-- Right column - FAQ items -->
			<div class="flex-1 space-y-3">
				{faqs.map((faq, i) => (
					<details
						class="faq-item group rounded-xl border border-gray-200 bg-white transition-all dark:border-vibe-purple-700 dark:bg-vibe-purple-800/50"
						style={`animation-delay: ${i * 0.05}s;`}
					>
						<summary class="flex cursor-pointer items-center justify-between gap-4 p-5 font-medium text-gray-900 dark:text-white">
							<span class="text-left">{faq.question}</span>
							<span class="flex-shrink-0 rounded-full bg-gray-100 p-2 transition-colors group-open:bg-vibe-purple/10 dark:bg-vibe-purple-700 dark:group-open:bg-vibe-yellow/20">
								<svg
									class="h-4 w-4 text-gray-500 transition-transform duration-200 group-open:rotate-45 group-open:text-vibe-purple dark:text-gray-400 dark:group-open:text-vibe-yellow"
									fill="none"
									viewBox="0 0 24 24"
									stroke="currentColor"
								>
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
								</svg>
							</span>
						</summary>
						<div class="border-t border-gray-100 px-5 pb-5 pt-4 dark:border-vibe-purple-700">
							<p class="text-gray-600 dark:text-gray-400">{faq.answer}</p>
						</div>
					</details>
				))}
			</div>
		</div>
	</div>
</section>

<style>
	.faq-item {
		animation: fadeInUp 0.5s ease-out both;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(15px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	details summary::-webkit-details-marker {
		display: none;
	}

	details[open] {
		@apply border-vibe-purple/30 dark:border-vibe-indigo/50;
	}
</style>

<script>
	function init() {
		const items = document.querySelectorAll('.faq-item');

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						(entry.target as HTMLElement).style.animationPlayState = 'running';
					}
				});
			},
			{ threshold: 0.1 }
		);

		items.forEach((item) => {
			(item as HTMLElement).style.animationPlayState = 'paused';
			observer.observe(item);
		});
	}

	document.removeEventListener('DOMContentLoaded', init);
	document.addEventListener('DOMContentLoaded', init);
</script>
