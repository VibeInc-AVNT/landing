---
import { getLangFromUrl, useTranslations } from "@i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const { class: className } = Astro.props;

const components = [
	{
		title: t("architecture.orchestrator"),
		content: t("architecture.orchestrator.content"),
		icon: `<svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/></svg>`,
		color: "text-vibe-purple",
		bgColor: "bg-vibe-purple/10",
	},
	{
		title: t("architecture.edge"),
		content: t("architecture.edge.content"),
		icon: `<svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
		color: "text-vibe-indigo",
		bgColor: "bg-vibe-indigo/10",
	},
	{
		title: t("architecture.dashboard"),
		content: t("architecture.dashboard.content"),
		icon: `<svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>`,
		color: "text-vibe-yellow",
		bgColor: "bg-vibe-yellow/10",
	},
	{
		title: t("architecture.gossip"),
		content: t("architecture.gossip.content"),
		icon: `<svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>`,
		color: "text-vibe-orange",
		bgColor: "bg-vibe-orange/10",
	},
];
---

<section id="architecture" class:list={["section relative bg-white py-24 lg:py-32", className]}>
	<div class="relative z-10 col-span-12">
		<!-- Section header -->
		<div class="mx-auto mb-16 max-w-3xl text-center lg:mb-20">
			<h2 class="font-display text-4xl font-bold uppercase text-gray-900 md:text-5xl lg:text-6xl">
				{t("architecture.title")}
			</h2>
		</div>

		<!-- Overview cards -->
		<div class="mx-auto mb-12 max-w-5xl grid gap-6 md:grid-cols-2">
			<!-- What It Is -->
			<div class="architecture-card neo-card bg-gray-50 p-8" style="animation-delay: 0s;">
				<h3 class="mb-3 text-xl font-bold text-vibe-purple">
					{t("architecture.what")}
				</h3>
				<p class="text-gray-700">
					{t("architecture.what.content")}
				</p>
			</div>

			<!-- How It's Built -->
			<div class="architecture-card neo-card bg-gray-50 p-8" style="animation-delay: 0.1s;">
				<h3 class="mb-3 text-xl font-bold text-vibe-indigo">
					{t("architecture.how")}
				</h3>
				<p class="text-gray-700">
					{t("architecture.how.content")}
				</p>
			</div>
		</div>

		<!-- Innovation callout -->
		<div class="mx-auto mb-12 max-w-5xl">
			<div class="architecture-card neo-card bg-gradient-to-br from-vibe-purple/10 to-vibe-indigo/10 p-8 border-2 border-vibe-purple/20" style="animation-delay: 0.2s;">
				<h3 class="mb-3 text-xl font-bold text-vibe-purple">
					{t("architecture.innovation")}
				</h3>
				<p class="text-gray-700 text-lg">
					{t("architecture.innovation.content")}
				</p>
			</div>
		</div>

		<!-- Components grid -->
		<div class="mx-auto max-w-5xl">
			<h3 class="mb-8 text-center text-2xl font-bold text-gray-900 md:text-3xl">
				Components
			</h3>
			<div class="grid gap-6 md:grid-cols-2">
				{components.map((component, i) => (
					<div
						class="architecture-card neo-card group bg-white p-8 border border-gray-200"
						style={`animation-delay: ${(i + 3) * 0.1}s;`}
					>
						<!-- Icon -->
						<div class={`mb-4 inline-flex p-3 rounded-xl ${component.bgColor} ${component.color}`}>
							<Fragment set:html={component.icon} />
						</div>

						<!-- Title -->
						<h4 class="mb-2 text-lg font-bold text-gray-900">
							{component.title}
						</h4>

						<!-- Content -->
						<p class="text-sm text-gray-600">
							{component.content}
						</p>
					</div>
				))}
			</div>
		</div>
	</div>
</section>

<style>
	.architecture-card {
		animation: fadeInUp 0.6s ease-out both;
	}

	@keyframes fadeInUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>

<script>
	function init() {
		const cards = document.querySelectorAll('.architecture-card');

		const observer = new IntersectionObserver(
			(entries) => {
				entries.forEach((entry) => {
					if (entry.isIntersecting) {
						(entry.target as HTMLElement).style.animationPlayState = 'running';
					}
				});
			},
			{ threshold: 0.2 }
		);

		cards.forEach((card) => {
			(card as HTMLElement).style.animationPlayState = 'paused';
			observer.observe(card);
		});
	}

	document.removeEventListener('DOMContentLoaded', init);
	document.addEventListener('DOMContentLoaded', init);
</script>
